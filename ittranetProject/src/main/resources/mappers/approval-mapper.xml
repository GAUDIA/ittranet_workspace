<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="appMapper">

	<resultMap id="appResultSet" type="Approval">
		<result column="dr_no" property="drNo" />
		<result column="dr_title" property="drTitle" />
		<result column="dr_date" property="drDate" />
		<result column="dr_status" property="drStatus" />
		<result column="dr_division" property="drDivision" />
		<result column="emp_name" property="empName" />
		<result column="team_name" property="teamName" />
	</resultMap>
	
	<resultMap id="appLineResultSet" type="AppLine">
		<result column="team_name" property="team" />
		<result column="job_name" property="job" />
		<result column="emp_id" property="empId" />
		<result column="emp_name" property="empName" />
	</resultMap>


	<!-- 결재선 검색 -->
	<select id="selectSearchTeam" resultMap="appLineResultSet">
		select
		       team_name, job_name, emp_id, emp_name 
		  from employee
		  join job using(job_code)
		  join team using(team_code)
		 where 
		       team_name like '%' || #{keyword} || '%'  
		 order
		    by team_name
	</select>
	
	<select id="selectSearchName" resultMap="appLineResultSet">
		select
		       team_name, job_name, emp_id, emp_name 
		  from employee
		  join job using(job_code)
		  join team using(team_code)
		 where 
			   emp_name like '%' || #{keyword} || '%' 		    
		 order
		    by emp_name
			   
	</select>

	<!-- 기안 게시판 -->
	<select id="selectListCount" resultType="_int">
		select
		       count(*)
		  from draft
		 where 
		<choose>
		 	<when test="category == 1">
		 		dr_status = '결재대기'
		 	</when>
		 	<when test="category == 2">
		 		dr_status = '진행중'		 		
		 	</when>
		 	<when test="category == 3">
		 		dr_status = '반려'
		 	and dr_status = '관리자반려'		 		
		 	</when>
		 	<when test="category == 4">
		 		dr_status = '완료'
		 	and dr_status = '관리자승인'		 		
		 	</when>
		 </choose>

	</select>
	
	<select id="selectList" resultMap="appResultSet">
		select 
		       dr_no
		     , dr_division  
		     , dr_title
		     , dr_date
		     , dr_status
		     , emp_name
		     , team_name
		  from draft
		  join employee using (emp_no)
		  join team using (team_code)
		 where
		 <choose>
		 	<when test="category == 1">
		 		dr_status = '결재대기'
		 	</when>
		 	<when test="category == 2">
		 		dr_status = '진행중'		 		
		 	</when>
		 	<when test="category == 3">
		 		dr_status = '반려'
		 	and dr_status = '관리자반려'		 		
		 	</when>
		 	<when test="category == 4">
		 		dr_status = '완료'
		 	and dr_status = '관리자승인'		 		
		 	</when>
		 </choose>
				 	
		 order 
		    by dr_date
	</select>
	
	<!-- 결재선 insert -->
	<insert id="insertLine">
		insert
		  into approval
	</insert>





</mapper>