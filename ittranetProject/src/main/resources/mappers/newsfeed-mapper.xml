<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
 
 <mapper namespace="newsfeedMapper">
 
 <resultMap type="Newsfeed" id="NewsfeedList">
 	<result column="nf_no" property="nfNo"/>
 	<result column="pr_no" property="prNo"/>
 	<result column="emp_no" property="empNo"/>
 	<result column="nf_content" property="nfContent"/>
 	<result column="nf_date" property="nfDate"/>
 	<result column="status" property="status"/>
 	<result column="pr_title" property="prTitle"  />
 	<result column="emp_name" property="empName"  />
 	<result column="profile"  property="profile"  />
 	<result column="pr_logo" property="prLogo"  />
 	<result column="origin_name" property="originName" />
	<result column="change_name" property="changeName" />
 </resultMap>
 
 	<resultMap id="attachment" type="Attachment">
		<result column="attachment_no" property="attachmentNo" />
		<result column="origin_name" property="originName" />
		<result column="change_name" property="changeName" />
		<result column="file_path" property="filePath" />
		<result column="ref_code" property="refCode" />
		<result column="ref_no" property="refNo" />
	</resultMap>
	
 <select id="selectNews" resultMap="NewsfeedList">
	select
	    nf_no
	   ,n.pr_no
	   ,n.emp_no
	   ,nf_content
	   ,nf_date
	   ,n.status
	   ,e.emp_name
	   ,e.profile
	   ,p.pr_title
	from newsfeed n
	join project p on p.pr_no = n.pr_no
	join employee e on e.emp_no = n.emp_no
	where n.emp_no = #{empNo}
	and n.status = 'Y'
 </select>
 
 <select id="newsProject" resultMap="NewsfeedList">
 	select
 		pr_title
 	   ,pr_logo	
 	   ,p.pr_no
    from project p
	join prmember pr on pr.pr_no = p.pr_no
	where pr.emp_no = #{empNo}
    and pr_enddate >= to_char(sysdate, 'mm/dd/yyyy')
 </select>
 
 <select id="prNewsfeed" resultMap="NewsfeedList">
 	select
	    nf_no
	   ,n.pr_no
	   ,n.emp_no
	   ,nf_content
	   ,nf_date
	   ,e.emp_name
	   ,e.profile
	   ,p.pr_title
	from newsfeed n
	join project p on p.pr_no = n.pr_no
	join employee e on e.emp_no = n.emp_no
	where p.pr_no = #{prNo}
	and n.status = 'Y'
 </select>
 
 <select id="nfNo" resultMap="NewsfeedList">
 	select
	    nf_no
	   ,n.pr_no
	   ,n.emp_no
	   ,nf_content
	   ,nf_date
	   ,e.emp_name
	   ,e.profile
	   ,p.pr_title
	from newsfeed n
	join project p on p.pr_no = n.pr_no
	join employee e on e.emp_no = n.emp_no
	where n.nf_no = #{nfNo}
 </select>
 
 <insert id="insertFeed">
 	insert
		  into NEWSFEED
		  (
		    nf_no
		  , nf_content
		  , nf_date
		  , pr_no
		  , emp_no
		  )
		  values
		  (
		    seq_nfno.nextval
		  , #{nfContent}
		  , sysdate
		  , #{prNo}
		  , #{empNo}
		  )
 </insert>

<insert id="insertAttachment">
	insert 
	      into attachment
	         (
	           attachment_no
	         , file_path
	         , origin_name
	         , change_name
	         , ref_code
	         , ref_no
	         )
	     values
	        (
	          seq_atno.nextval
	        , #{filePath}
	        , #{originName}
	        , #{changeName}
	        , 'NF'
	        , seq_nfno.currval
	        )
</insert>

<select id="prAttachment" resultMap="attachment">
 		select attachment_no
 		     , origin_name
 		     , change_name
 		     , file_path
 			 , ref_no
		  from attachment
		 where ref_Code = 'B'
		   and ref_no = #{boardNo}


</select>
 
 <update id="deleteFeed">
		 update
		       newsfeed
		   set status = 'N'
		 where nf_no = #{nfNo}
 </update>
 
 </mapper>